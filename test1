SELECT COUNT(DISTINCT g1.Rpt_ID)
FROM grouped_trades AS g1
INNER JOIN (
    SELECT DISTINCT Rpt_ID
    FROM grouped_trades
    WHERE Pty_R = '18' AND ORFInd = 'Y'
) AS g2 ON g1.Rpt_ID = g2.Rpt_ID
WHERE g1.Pty_R = '1';




# Create a list of Rpt_IDs to update
rpt_ids_to_update = conn.execute(f"""
    SELECT DISTINCT g1.Rpt_ID
    FROM grouped_trades AS g1
    INNER JOIN (
        SELECT DISTINCT Rpt_ID
        FROM grouped_trades
        WHERE Pty_R = '18' AND ORFInd = 'Y'
    ) AS g2 ON g1.Rpt_ID = g2.Rpt_ID
    WHERE g1.Pty_R = '1'
    LIMIT {total_rows_to_update};
""").fetchall()

