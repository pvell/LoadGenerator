#!/bin/bash

# Define your SFTP server information
sftp_server="user@sftp_server_ip_or_hostname"
sftp_user="your_username"

# Calculate the previous day in MM-DD format
previous_date=$(date -d "yesterday" +"%m-%d")

# Construct the remote directory path on the SFTP server
remote_directory="/path/to/remote/files"

# Construct the source file pattern to match the files with the previous day's MM-DD.csv pattern
file_pattern="$previous_date.csv"

# Construct the destination directory on your local machine
local_directory="/path/to/local/folder"

# Use SSH to connect to the SFTP server and list files matching the pattern
file_list=$(ssh $sftp_server "cd $remote_directory; ls $file_pattern")

# Use sftp to retrieve each file from the SFTP server
for remote_file in $file_list; do
    sftp $sftp_user@$sftp_server:$remote_directory/$remote_file $local_directory/
done

# Check the exit status of the sftp commands
if [ $? -eq 0 ]; then
    echo "Files matching $file_pattern retrieved successfully."
else
    echo "Error: Files matching $file_pattern retrieval failed."
fi
