import pymqi

# Connection details
queue_manager = "YOUR_QUEUE_MANAGER"
channel = "YOUR_CHANNEL"
host = "YOUR_MQ_HOST"
port = 1414
queue_name = "YOUR_QUEUE_NAME"

# Connection properties
conn_info = f"{host}({port})"
qmgr = None

# Connect to the queue manager
try:
    qmgr = pymqi.QueueManager(None)
    qmgr.connect(queue_manager, channel, conn_info)
    print("Connected to queue manager")

    # Access the queue
    queue = pymqi.Queue(qmgr, queue_name)
    print(f"Opened queue '{queue_name}'")

    # Set the options for the message
    get_message_options = pymqi.gmo(Options=pymqi.CMQC.MQGMO_WAIT | pymqi.CMQC.MQGMO_FAIL_IF_QUIESCING)
    get_message_options.WaitInterval = 5000  # 5 seconds

    while True:
        # Get a message from the queue
        try:
            message = queue.get(None, None, get_message_options)
            print(f"Received message: {message}")
        except pymqi.MQMIError as e:
            if e.comp == pymqi.CMQC.MQCC_FAILED and e.reason == pymqi.CMQC.MQRC_NO_MSG_AVAILABLE:
                print("No messages available. Waiting...")
                continue
            else:
                raise

except Exception as e:
    print(f"Error: {e}")

finally:
    # Disconnect from the queue manager
    if qmgr:
        qmgr.disconnect()
        print("Disconnected from queue manager")
