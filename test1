Traceback (most recent call last):
  File "/data/pvellanki/bizdev/dump2excel.py", line 30, in <module>
    with gzip.open(f'{output_file_name}.gz', 'wb') as f_out:
NameError: name 'gzip' is not defined. Did you mean: 'zip'?



import pandas as pd
import sqlite3
import datetime
import sys
import os

db_name = sys.argv[1]
# Connect to the SQLite database
conn = sqlite3.connect(db_name)

# Query the data from the grouped_trades_new table
query = "SELECT * FROM grouped_trades"

# Fetch the data into a pandas DataFrame
grouped_trade_data_frame = pd.read_sql_query(query, conn)

# Close the database connection
conn.close()

# Generate the timestamp for the file name up to minutes
timestamp = datetime.datetime.now().strftime('%Y-%m-%d_%H-%M')
file_name = db_name[5:10]
# Write the grouped_trade_data_frame and pivoted_trade_data_frame to an Excel file with separate sheets
output_file_name = f'summary_trade_data_{file_name}.csv'

grouped_trade_data_frame.to_csv(output_file_name, index=False)

with open(output_file_name, 'rb') as f_in:
    with gzip.open(f'{output_file_name}.gz', 'wb') as f_out:
        f_out.writelines(f_in)



os.remove(output_file_name)

print(f"Data from grouped_trades_summary has been successfully dumped to '{output_file_name}'.")
