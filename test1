# Randomly select an underlier
selected_underlier = choice(underliers_to_check)

# Get the associated options security IDs for the selected underlier
selected_options_security_ids = options_security_ids_by_underlier[selected_underlier]

# Generate a random message type based on the weights
message_type = generate_message_type()

# Generate one or two messages
new_order_single_message, order_cancel_message = generate_message(message_type, selected_underlier, selected_options_security_ids, send_cancels=config.getboolean('Load', 'SendCancels'))

# Send the NewOrderSingle message
if new_order_single_message:
    send_message(client_socket, new_order_single_message)

# Send the OrderCancelRequest message if it's generated
if order_cancel_message:
    send_message(client_socket, order_cancel_message)
