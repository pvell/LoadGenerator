#!/bin/bash

# Define your SFTP server information
sftp_server="user@sftp_server_ip_or_hostname"
sftp_user="your_username"
sftp_password="your_password"

# Calculate the previous day in MM-DD format
previous_date=$(date -d "yesterday" +"%m-%d")

# Construct the remote directory path on the SFTP server
remote_directory="/path/to/remote/files"

# Construct the source file pattern to match the files with the previous day's MM-DD.csv pattern
file_pattern="$previous_date.csv"

# Construct the destination directory on your local machine
local_directory="/path/to/local/folder"

# Use lftp to retrieve files matching the pattern from the SFTP server
lftp -u $sftp_user,$sftp_password $sftp_server <<EOF
mirror --include "$file_pattern" $remote_directory $local_directory
bye
EOF

# Check the exit status of lftp
if [ $? -eq 0 ]; then
    echo "Files matching $file_pattern retrieved successfully."
else
    echo "Error: Files matching $file_pattern retrieval failed."
fi
