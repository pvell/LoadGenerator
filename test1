import quickfix as fix

class MyApplication(fix.Application):
    def __init__(self, log_file_path):
        self.log_file_path = log_file_path

    def fromApp(self, message, sessionID):
        # Log the received message to the specified file
        try:
            with open(self.log_file_path, "a") as log_file:
                log_file.write(f"Received FIX Message: {message.toString()}\n")
        except Exception as e:
            print(f"Error logging message: {e}")

    def toApp(self, message, sessionID):
        pass

    def fromAdmin(self, message, sessionID):
        pass

    def toAdmin(self, message, sessionID):
        pass

def main():
    try:
        settings = fix.SessionSettings("connections.cfg")

        # Retrieve log file path from the [DEFAULT] section
        log_file_path = settings.get("FileLogPath")

        application = MyApplication(log_file_path)
        storeFactory = fix.FileStoreFactory(settings)
        logFactory = fix.FileLogFactory(settings)

        acceptor = fix.SocketAcceptor(application, storeFactory, settings, logFactory)
        acceptor.start()

        while True:
            pass  # Add your main application logic here

        acceptor.stop()

    except (fix.ConfigError, fix.RuntimeError) as e:
        print(f"Error: {e}")

if __name__ == "__main__":
    main()
