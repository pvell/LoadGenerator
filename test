import configparser
import quickfix as fix

class MyApplication(fix.Application):
    def __init__(self):
        super().__init__()
        self.session_id = None

    def onCreate(self, sessionID):
        print("Session created -", sessionID.toString())
        self.session_id = sessionID

    def onLogon(self, sessionID):
        print("Logged on -", sessionID.toString())

    def onLogout(self, sessionID):
        print("Logged out -", sessionID.toString())

    def toAdmin(self, message, sessionID):
        print("Sending admin message -", message.toString())

    def fromAdmin(self, message, sessionID):
        print("Receiving admin message -", message.toString())

    def toApp(self, message, sessionID):
        print("Sending application message -", message.toString())

    def fromApp(self, message, sessionID):
        print("Receiving application message -", message.toString())

def send_logon():
    # Load the configuration from config.ini
    config = configparser.ConfigParser()
    config.read('config.ini')

    # Read the configuration values
    connection_config_file = config.get('LoadGenerator', 'connection_config_file')

    # Create the SessionSettings object
    settings = fix.SessionSettings(connection_config_file)

    # Create the message store factory
    store_factory = fix.FileStoreFactory(settings)

    # Create the application
    application = MyApplication()

    # Create the initiator
    initiator = fix.SocketInitiator(application, store_factory, settings)

    # Start the initiator
    initiator.start()

    # Wait for the session to logon
    while not application.session_id:
        fix.sleep(1)

    # Get the session ID
    session_id = application.session_id
    if session_id:
        print("Session ID:", session_id.toString())
    else:
        print("Session not found.")

    # Create and send the logon message
    logon_message = fix.Message()
    logon_message.getHeader().setField(fix.MsgType("A"))
    # Set other logon message fields as needed
    # ...

    fix.Session.sendToTarget(logon_message, session_id)

    # Stop the initiator
    initiator.stop()

def main():
    send_logon()

if __name__ == '__main__':
    main()
