from sbe import Codec

# Step 1: Parse the schema
with open('sbe-schema.xml', 'r') as f:
    schema_xml = f.read()

# Step 2: Create a codec instance
codec = Codec(schema_xml)

# Step 3: Define the message ID and input message for encoding
message_id = 1

# Step 4: Set field values in the message object
message = codec.get_message_template(message_id)
message.set_field('userId', 11)
message.set_field('timestamp', 1598784004840)
message.set_field('orderSize', 0)
message.set_field('price', 5678.0)
# Add other field assignments based on your schema

# Step 5: Encoding
encoded = codec.encode(message)

# Print the encoded bytes
print("Encoded message:")
print(encoded)

# Step 6: Decoding
decoded_message = codec.decode(encoded)

# Print the decoded message fields
print("Decoded message:")
for field_name in decoded_message.fields:
    field_value = decoded_message.get_field(field_name)
    print(f"{field_name}: {field_value}")
