import sqlite3

# Connect to the original SQLite database
conn = sqlite3.connect('trades.db')

# Drop the 'grouped_trades' table if it exists
conn.execute('DROP TABLE IF EXISTS grouped_trades')

# Create a new table to store the query results
conn.execute('''CREATE TABLE grouped_trades AS
                 SELECT 
                     Side,
                     Rpt_ID,
                     FIRST_VALUE(Quantity) AS Quantity,
                     FIRST_VALUE(Ultimate_Clearing_Firm) AS Ultimate_Clearing_Firm,
                     FIRST_VALUE(Entering_Firm_Col1) AS Entering_Firm_Col1,
                     FIRST_VALUE(Sub_ID) AS Sub_ID
                 FROM trades
                 WHERE Sub_ID IS NOT NULL AND Sub_ID != ''
                 GROUP BY Side, Rpt_ID''')

# Commit the changes and close the connection to the original database
conn.commit()
conn.close()

print("Data has been successfully inserted into the 'grouped_trades' table.")
