def generate_load(self):
    # Read the template file and extract message templates
    with open(self.template_file, 'r') as file:
        templates = file.readlines()

    # Convert message weights to integers
    message_weights = {key: int(value) for key, value in self.message_weights.items()}

    # Generate messages based on weights
    load = []
    for template in templates:
        message_type = self.get_message_type(template)
        if message_type and message_type in message_weights:
            weight = message_weights[message_type]
            load.extend([template.strip()] * weight)

    random.shuffle(load)
    load_length = len(load)
    iterations = int(self.message_rate * self.send_duration)

    # Repeat load if necessary to achieve desired send duration
    if iterations > load_length:
        quotient, remainder = divmod(iterations, load_length)
        load = load * quotient + load[:remainder]
    else:
        load = load[:iterations]

    return load
