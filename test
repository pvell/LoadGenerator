from encoder import MyEncoder
from decoder import MyDecoder
from sbe import NewOrderSingle, SideType, Price, TimeInForceType, OrderCapacityType, ExecInstType, OrdType

# Construct a NewOrderSingle message
new_order_single = NewOrderSingle()
new_order_single.ClOrdID = 12345
new_order_single.Account = "A123"
new_order_single.Symbol = "AAPL"
new_order_single.Side = SideType.Buy
new_order_single.Price = Price(123456, -2)
new_order_single.TimeInForce = TimeInForceType.Day
new_order_single.OrderCapacity = OrderCapacityType.Agency
new_order_single.CustOrderCapacity = "C"
new_order_single.ExecInst = ExecInstType.ParticipateDoNotInitiate
new_order_single.OrdType = OrdType.Limit

# Create an instance of the encoder
encoder = MyEncoder(schema=None)  # Pass the schema if required

# Encode the NewOrderSingle message
encoder.encode_int32_type(new_order_single.ClOrdID)
encoder.encode_string_type(new_order_single.Account)
encoder.encode_string_type(new_order_single.Symbol)
encoder.encode_side_type(new_order_single.Side)
encoder.encode_price_type(new_order_single.Price)
encoder.encode_time_in_force_type(new_order_single.TimeInForce)
encoder.encode_order_capacity_type(new_order_single.OrderCapacity)
encoder.encode_string_type(new_order_single.CustOrderCapacity)
encoder.encode_exec_inst_type(new_order_single.ExecInst)
encoder.encode_ord_type(new_order_single.OrdType)
encoded_data = encoder.get_encoded_data()

# Create an instance of the decoder
decoder = MyDecoder(schema=None, buffer=encoded_data)  # Pass the schema if required

# Decode the received data
cl_ord_id = decoder.decode_int32_type()
account = decoder.decode_string_type()
symbol = decoder.decode_string_type()
side = decoder.decode_side_type()
price = decoder.decode_price_type()
time_in_force = decoder.decode_time_in_force_type()
order_capacity = decoder.decode_order_capacity_type()
cust_order_capacity = decoder.decode_string_type()
exec_inst = decoder.decode_exec_inst_type()
ord_type = decoder.decode_ord_type()

# Print the decoded fields
print(f"ClOrdID: {cl_ord_id}")
print(f"Account: {account}")
print(f"Symbol: {symbol}")
print(f"Side: {side}")
print(f"Price: {price.mantissa} x 10^{price.exponent}")
print(f"TimeInForce: {time_in_force}")
print(f"OrderCapacity: {order_capacity}")
print(f"CustOrderCapacity: {cust_order_capacity}")
print(f"ExecInst: {exec_inst}")
print(f"OrdType: {ord_type}")
