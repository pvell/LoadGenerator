import sbe

# Step 1: Parse the schema
with open('sbe-schema.xml', 'r') as f:
    schema = sbe.Schema.parse(f)

# Step 2: Define the message ID and input message for encoding
message_id = 1

# Step 3: Create a class based on the message structure
message_struct = schema.messages[message_id].structure

class MessageClass(sbe.Struct):
    _fields = message_struct

# Step 4: Create an instance of the message class and set field values
obj = MessageClass()
obj.SendingTime = 1623155790000000000
obj.ClOrdID = 'ABC123'
obj.OptionsSecurityID = 'XYZ456'
obj.Side = 'Buy'
obj.OrderQty = 100
obj.OrdType = 'Market'
obj.Price = '5678.0'
obj.TimeInForce = 'Day'
obj.OpenOrClose = 'Open'
obj.ExecInst = 'DoNotIncrease'
obj.TradingCapacity = 'Principal'
obj.RepriceFrequency = 'Daily'
obj.RepriceBehavior = 'CancelOldest'
obj.MtpGroupID = 1
obj.MatchTradePrevention = 'PreventSelfMatch'
obj.CancelGroupID = 2
obj.RiskGroupID = 3

# Step 5: Encoding
encoded = schema.encode(schema.messages[message_id], obj)

# Print the encoded bytes
print("Encoded message:")
print(encoded)

# Step 6: Decoding
decoded = schema.decode(encoded)

# Print the decoded message
print("Decoded message:")
print(decoded)
