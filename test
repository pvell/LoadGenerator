generated_message = "8=FIXT.1.19=21035=D34=6249=QAXMXE1352=20230707-18:03:43.26656=MXOP11=30750718=h38=10040=244=854=255=AMD59=060=20230707-18:03:43.26677=O201=1202=100447=D448=QAX1452=66453=1541=2309151815=621035=A004000110=219"

fields = ['453', '448', '447', '452']
rearranged_fields = []

for field in fields:
    start_index = generated_message.find(field + '=')
    if start_index != -1:
        end_index = generated_message.find('=', start_index + len(field) + 1)
        if end_index != -1:
            value = generated_message[start_index + len(field) + 1: end_index]
            rearranged_fields.append(field + '=' + value)

rearranged_message = ''.join(rearranged_fields)

print(rearranged_message)




def send_new_order_single(self, order_type, time_in_force, order_qty, symbol, exec_inst=''):
    with open(self.app.template_file, 'r') as file:
        template_messages = file.readlines()

    for template_message in template_messages:
        placeholders = {
            '<ClOrdID>': self.app.generate_clordid(),
            '<OrderQty>': str(order_qty),
            '<Symbol>': symbol,
            '<OrdType>': order_type,
            '<TimeInForce>': time_in_force,
            '<ExecInst>': exec_inst
        }
        message = replace_placeholders(template_message, placeholders)

        new_order_message = fix.Message()
        new_order_message.setString(message, False, self.app.message_factory)

        # Create the repeating group
        party_group = fix.Group(453, 448, 447, 452)

        # Add party details to the repeating group
        party_group.setField(448, "QAX1")
        party_group.setField(447, "D")
        party_group.setField(452, "66")

        # Add the repeating group to the message
        new_order_message.addGroup(party_group)

        fix.Session.sendToTarget(new_order_message, self.session_id)

        time.sleep(2)

        self.assertTrue(self.app.execution_report_received)
        exec_report = self.app.last_execution_report
        cl_ord_id = exec_report.getField(11)

        validate_execution_report(exec_report, order_qty=order_qty, symbol=symbol, order_type=order_type, tif=time_in_force)
        self.assertEqual(exec_report.getField(39), '0')



# Create the repeating group
party_group = fix.Group(453, 448, [447, 452])

# Set the number of repeating groups
party_group.setField(453, "1")

# Set the values for the first party group instance
party_group.setField(448, "PartyID1")
party_group.setField(447, "PartyIDSource1")
party_group.setField(452, "PartyRole1")




def generate_message(self, template, session_id):
    # Replace placeholders in the message template
    message = template.replace('<ClOrdID>', self.generate_clordid())

    # Generate the SendingTime in the desired format
    sending_time = datetime.datetime.utcnow().strftime('%Y%m%d-%H:%M:%S.%f')[:-3]
    message = message.replace('<SendingTime>', sending_time)

    # Create the repeating group string
    party_group = "453=1|448=PartyID1|447=PartyIDSource1|452=PartyRole1|"

    # Insert the repeating group into the message
    message = message.replace('<RepeatingGroup>', party_group)

    return message


# Add the repeating group to the message
message.setField(party_group)


sent application message 8=FIXT.1.19=23535=D34=749=QAXMXE1352=20230710-14:03:04.62556=MXOP11=79430018=h38=10040=244=854=255=AMD59=060=20230710-14:03:04.62577=O201=1202=100453=1|448=PartyID1|447=PartyIDSource1|452=PartyRole1|541=2309151815=621035=A004000110=152
8=FIXT.1.19=9235=334=1349=MXOP52=20230710-14:03:04.62556=QAXMXE1245=758=Invalid Value371=453372=D10=206

